<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Colis Timer</title>
</head>
<body>
  <h1>ğŸ“¦ Colis Timer</h1>

  <label for="employe">EmployÃ© :</label>
  <select id="employe">
    <option value="1">Jean Dupont</option>
    <option value="2">Claire Martin</option>
    <option value="3">Paul Durand</option>
    <option value="4">Sophie Bernard</option>
    <option value="5">Luc Petit</option>
    <option value="6">Julie Robert</option>
  </select>
  <br><br>

  <label for="nb_colis">Nombre de colis :</label>
  <input type="number" id="nb_colis" min="1">
  <br><br>

  <button onclick="ajouterSession()">âœ… Enregistrer</button>

  <h2>ğŸ“Š Sessions rÃ©centes</h2>
  <ul id="sessions"></ul>

  <script>
    const API_URL = "https://colis-timer-backend.onrender.com";

    // // â• Ajouter une session
async function ajouterSession() {
  const employe_id = document.getElementById("employe").value;
  const nb_colis = document.getElementById("nb_colis").value;

  console.log("â¡ï¸ Envoi :", { employe_id, nb_colis }); // log des donnÃ©es envoyÃ©es

  try {
    const res = await fetch(`${API_URL}/sessions`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ employe_id, nb_colis })
    });

    console.log("ğŸ“© RÃ©ponse brute :", res);

    if (res.ok) {
      alert("âœ… Session enregistrÃ©e !");
      chargerSessions();
    } else {
      const errText = await res.text();
      console.error("âŒ Erreur serveur :", errText);
      alert("âŒ Erreur lors de lâ€™enregistrement : " + errText);
    }
  } catch (err) {
    console.error("ğŸ’¥ Erreur rÃ©seau :", err);
    alert("ğŸ’¥ Impossible de contacter lâ€™API");
  }
}

    // ğŸ“¥ Charger les sessions
    async function chargerSessions() {
      const res = await fetch(`${API_URL}/sessions/details`);
      const data = await res.json();

      const list = document.getElementById("sessions");
      list.innerHTML = "";
      data.forEach(s => {
        const li = document.createElement("li");
        li.textContent = `${s.employe_prenom} ${s.employe_nom} (${s.supermarche}) â†’ ${s.nb_colis} colis`;
        list.appendChild(li);
      });
    }

    // Charger au dÃ©marrage
    chargerSessions();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Colis Timer</title>
</head>
<body>
  <h1>📦 Colis Timer</h1>

  <label for="employe">Employé :</label>
  <select id="employe">
    <option value="1">Jean Dupont</option>
    <option value="2">Claire Martin</option>
    <option value="3">Paul Durand</option>
    <option value="4">Sophie Bernard</option>
    <option value="5">Luc Petit</option>
    <option value="6">Julie Robert</option>
  </select>
  <br><br>

  <label for="nb_colis">Nombre de colis :</label>
  <input type="number" id="nb_colis" min="1">
  <br><br>

  <button onclick="ajouterSession()">✅ Enregistrer</button>

  <h2>📊 Sessions récentes</h2>
  <ul id="sessions"></ul>

  <script>
    const API_URL = "https://colis-timer-backend.onrender.com";

    // // ➕ Ajouter une session
async function ajouterSession() {
  const employe_id = document.getElementById("employe").value;
  const nb_colis = document.getElementById("nb_colis").value;

  console.log("➡️ Envoi :", { employe_id, nb_colis }); // log des données envoyées

  try {
    const res = await fetch(`${API_URL}/sessions`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ employe_id, nb_colis })
    });

    console.log("📩 Réponse brute :", res);

    if (res.ok) {
      alert("✅ Session enregistrée !");
      chargerSessions();
    } else {
      const errText = await res.text();
      console.error("❌ Erreur serveur :", errText);
      alert("❌ Erreur lors de l’enregistrement : " + errText);
    }
  } catch (err) {
    console.error("💥 Erreur réseau :", err);
    alert("💥 Impossible de contacter l’API");
  }
}

    // 📥 Charger les sessions
    async function chargerSessions() {
      const res = await fetch(`${API_URL}/sessions/details`);
      const data = await res.json();

      const list = document.getElementById("sessions");
      list.innerHTML = "";
      data.forEach(s => {
        const li = document.createElement("li");
        li.textContent = `${s.employe_prenom} ${s.employe_nom} (${s.supermarche}) → ${s.nb_colis} colis`;
        list.appendChild(li);
      });
    }

    // Charger au démarrage
    chargerSessions();
  </script>
</body>
</html>
